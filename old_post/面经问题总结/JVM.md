### 1 如何检测内存泄漏

这是一个开放问题，可以使用JVisualVM可视化工具来检测。

1. 在JVisualVM中可以查看到运行在本地和远程的VM上的进程。
2. 使用Visual GC标签可以看到进程的堆使用情况。
3. 使用dump可以截取当时的堆内存转储快照。
4. 将不同时间的快照进行对比，可以查看到不同类的实例的数量改变情况，分析出可能发生内存泄漏的类。
5. 将类选择在实例视图中显示，可以显示此类有哪些实例，并且可以查看这些实例被哪些类引用，进而可以定位代码中何处发生了内存泄漏。



### 2 CPU 总是 100%，怎么定位问题，并且解决

1. 通过任务管理器查看哪个进程占用CPU较高，如果和JVM无关则关闭一些进程。
2. 使用JVisualVM，找到占用CPU最高的进程，再定位到运行时间最长的线程。
3. dump此线程，查看此线程卡在哪一步，查看代码是否发生了死循环。



### 3 CPU 时而 100%，内存经常 100%，怎么定位问题，并且解决

有可能发生了内存泄漏，见问题1。



### 4 触发GC的条件

1. 新生代空间不足，触发新生代GC。
2. 在进行新生代GC之前，会先计算新生代存活对象的总和。如果小于老年代的连续可用空间，那么直接进行新生代GC。如果大于老年代的连续可用空间，会检查是否允许担保失败，如果不允许，触发FULLGC。如果允许，会计算历次新生代GC时，晋升到老年代的对象和的平均值，若这个值大于老年代连续可用空间，则触发FULLGC，若小于则可以进行一次新生代GC，若担保失败，再触发一次FULLGC。
3. 元空间不足，FULLGC。
4. 显式调用System.gc()。
5. 一些垃圾收集器，比如parallel scanvenge，CMS，G1等，会根据自己关注的参数，比如吞吐量，停顿时间等，在空间使用比例到达阈值时主动GC。
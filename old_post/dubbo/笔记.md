### 1 分布式系统

1. 定义

   分布式系统是若干独立计算机的集合，这些计算机对于用户来说就像单个系统。

2. 发展演变

   - 单一应用架构

     - 扩展不易，每次修改要重新部署
     - 协同开发不易，各个功能模块需要在同一个工程中开发

   - 垂直应用架构

     根据功能拆分为若干个小应用，每个小应用都是一个完整的应用。

     - 界面和业务逻辑没有分离
     - 应用之间不可能完全独立

   - 分布式的服务架构

     - 将业务逻辑和界面分离，界面可以调用不同的业务service，业务之间也可以互调
     - 难点就在于如何拆分业务，如何实现远程过程调用（RPC）

   - 流动计算架构

     调度治理中心，基于访问压力实时管理服务数量，提高整体集群的资源利用率。

3. RPC

   远程过程调用

   RPC基本原理：![image-20200311112413767](../images/%E7%AC%94%E8%AE%B0.assets/image-20200311112413767.png)

   影响RPC框架的性能因素：

   - 通信效率
   - 序列化与反序列化效率



### 2 Dubbo

一款高性能的RPC框架。

1. 面向接口代理的远程调用，像mybatis一样。

2. 负载均衡

3. 服务自动注册与发现

   引入注册中心的概念，将所有业务注册到注册中心统一管理。在调用前先查询注册中心。

4. 高度可扩展能力

5. 运行期流量调度

   灰度发布，发布时使用一个过度机制。

6. 可视化的服务治理与运维



#### 2.1 Dubbo架构

![dubbo-architucture](../images/%E7%AC%94%E8%AE%B0.assets/dubbo-architecture.jpg)



### 2.2 高可用

1. dubbo直连

   dubbo访问注册中心后能够缓存服务的位置，如果注册中心宕机，也能够通过缓存访问到服务，提高了可用性。

   即使没有注册中心，也能够通过直连方式访问到服务。

2. 负载均衡

   - 基于权重的随机访问
   - 基于权重的轮询访问
   - 最小活跃数，访问上一次响应最快的
   - 一致性hash

3. 服务降级

   当服务器压力剧增的情况下，根据实际业务及流量，对一些服务和页面有策略的不处理或换种简单的方式处理，从而释放服务器资源以保证核心业务正常运作或高效运作。

4. 容错机制



### 2.3 原理

1. RPC原理

   使用接口远程调用，屏蔽掉中间的实现细节，网络使用Netty基于NIO模型。

2. 